(function(c,a,b){a.infinitescroll=function(d,b,c){this.element=a(c);if(!this._create(d,b))this.failed=true};a.infinitescroll.defaults={loading:{finished:b,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:b},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,currPage:1},callback:b,debug:false,behavior:b,binder:a(c),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:false,pathParse:b,dataType:"html",appendCallback:true,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:b,path:b};a.infinitescroll.prototype={_binding:function(a){var c=this,d=c.options;d.v="2.0b2.111027";if(!!d.behavior&&this["_binding_"+d.behavior]!==b){this["_binding_"+d.behavior].call(this);return}if(a!=="bind"&&a!=="unbind"){this._debug("Binding value  "+a+" not valid");return false}if(a=="unbind")this.options.binder.unbind("smartscroll.infscr."+c.options.infid);else this.options.binder[a]("smartscroll.infscr."+c.options.infid,function(){c.scroll()});this._debug("Binding",a)},_create:function(e,d){var c=a.extend(true,{},a.infinitescroll.defaults,e);if(!this._validate(e))return false;this.options=c;var f=a(c.nextSelector).attr("href");if(!f){this._debug("Navigation selector not found");return false}c.path=this._determinepath(f);c.contentSelector=c.contentSelector||this.element;c.loading.selector=c.loading.selector||c.contentSelector;c.loading.msg=c.loading.msg||a('<div id="infscr-loading"><img alt="Loading..." src="'+c.loading.img+'" /><div>'+c.loading.msgText+"</div></div>");(new Image).src=c.loading.img;c.pixelsFromNavToBottom=a(document).height()-a(c.navSelector).offset().top;c.loading.start=c.loading.start||function(){a(c.navSelector).hide();c.loading.msg.appendTo(c.loading.selector).show(c.loading.speed,function(){beginAjax(c)})};c.loading.finished=c.loading.finished||function(){c.loading.msg.fadeOut("normal")};c.callback=function(e,f){!!c.behavior&&e["_callback_"+c.behavior]!==b&&e["_callback_"+c.behavior].call(a(c.contentSelector)[0],f);d&&d.call(a(c.contentSelector)[0],f,c)};this._setup();return true},_debug:function(){if(this.options&&this.options.debug)return c.console&&console.log.call(console,arguments)},_determinepath:function(a){var c=this.options;if(!!c.behavior&&this["_determinepath_"+c.behavior]!==b){this["_determinepath_"+c.behavior].call(this,a);return}if(!!c.pathParse){this._debug("pathParse manual");return c.pathParse(a,this.options.state.currPage+1)}else if(a.match(/^(.*?)\b2\b(.*?$)/))a=a.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(a.match(/^(.*?)2(.*?$)/)){if(a.match(/^(.*?page=)2(\/.*|$)/)){a=a.match(/^(.*?page=)2(\/.*|$)/).slice(1);return a}a=a.match(/^(.*?)2(.*?$)/).slice(1)}else if(a.match(/^(.*?page=)1(\/.*|$)/)){a=a.match(/^(.*?page=)1(\/.*|$)/).slice(1);return a}else{this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");c.state.isInvalidPage=true}this._debug("determinePath",a);return a},_error:function(c){var a=this.options;if(!!a.behavior&&this["_error_"+a.behavior]!==b){this["_error_"+a.behavior].call(this,c);return}if(c!=="destroy"&&c!=="end")c="unknown";this._debug("Error",c);c=="end"&&this._showdonemsg();a.state.isDone=true;a.state.currPage=1;a.state.isPaused=false;this._binding("unbind")},_loadcallback:function(f,e){var d=this.options,i=this.options.callback,k=d.state.isDone?"done":!d.appendCallback?"no-append":"append",g;if(!!d.behavior&&this["_loadcallback_"+d.behavior]!==b){this["_loadcallback_"+d.behavior].call(this,f,e);return}switch(k){case"done":this._showdonemsg();return false;break;case"no-append":if(d.dataType=="html"){e="<div>"+e+"</div>";e=a(e).find(d.itemSelector)}break;case"append":var h=f.children();if(h.length==0)return this._error("end");g=document.createDocumentFragment();while(f[0].firstChild)g.appendChild(f[0].firstChild);this._debug("contentSelector",a(d.contentSelector)[0]);a(d.contentSelector)[0].appendChild(g);e=h.get()}d.loading.finished.call(a(d.contentSelector)[0],d);if(d.animate){var j=a(c).scrollTop()+a("#infscr-loading").height()+d.extraScrollPx+"px";a("html,body").animate({scrollTop:j},800,function(){d.state.isDuringAjax=false})}if(!d.animate)d.state.isDuringAjax=false;i(this,e)},_nearbottom:function(){var d=this.options,e=0+a(document).height()-d.binder.scrollTop()-a(c).height();if(!!d.behavior&&this["_nearbottom_"+d.behavior]!==b)return this["_nearbottom_"+d.behavior].call(this);this._debug("math:",e,d.pixelsFromNavToBottom);return e-d.bufferPx<d.pixelsFromNavToBottom},_pausing:function(a){var c=this.options;if(!!c.behavior&&this["_pausing_"+c.behavior]!==b){this["_pausing_"+c.behavior].call(this,a);return}a!=="pause"&&a!=="resume"&&a!==null&&this._debug("Invalid argument. Toggling pause value instead");a=a&&(a=="pause"||a=="resume")?a:"toggle";switch(a){case"pause":c.state.isPaused=true;break;case"resume":c.state.isPaused=false;break;case"toggle":c.state.isPaused=!c.state.isPaused}this._debug("Paused",c.state.isPaused);return false},_setup:function(){var a=this.options;if(!!a.behavior&&this["_setup_"+a.behavior]!==b){this["_setup_"+a.behavior].call(this);return}this._binding("bind");return false},_showdonemsg:function(){var c=this.options;if(!!c.behavior&&this["_showdonemsg_"+c.behavior]!==b){this["_showdonemsg_"+c.behavior].call(this);return}c.loading.msg.find("img").hide().parent().find("div").html(c.loading.finishedMsg).animate({opacity:1},2e3,function(){a(this).parent().fadeOut("normal")});c.errorCallback.call(a(c.contentSelector)[0],"done")},_validate:function(c){for(var b in c)if(b.indexOf&&b.indexOf("Selector")>-1&&a(c[b]).length===0){this._debug("Your "+b+" found no elements.");return false}return true},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=true;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(i){var c=this,d=c.options,j=d.path,e,l,h,g,f,i=i||null,k=!!i?i:d.state.currPage;beginAjax=function(d){d.state.currPage++;c._debug("heading into ajax",j);e=a(d.contentSelector).is("table")?a("<tbody/>"):a("<div/>");h=j.join(d.state.currPage);g=d.dataType=="html"||d.dataType=="json"?d.dataType:"html+callback";if(d.appendCallback&&d.dataType=="html")g+="+callback";switch(g){case"html+callback":c._debug("Using HTML via .load() method");e.load(h+" "+d.itemSelector,b,function(a){c._loadcallback(e,a)});break;case"html":c._debug("Using "+g.toUpperCase()+" via $.ajax() method");a.ajax({url:h,dataType:d.dataType,complete:function(a,b){f=typeof a.isResolved!=="undefined"?a.isResolved():b==="success"||b==="notmodified";f?c._loadcallback(e,a.responseText):c._error("end")}});break;case"json":c._debug("Using "+g.toUpperCase()+" via $.ajax() method");a.ajax({dataType:"json",type:"GET",url:h,success:function(i,a,h){f=typeof h.isResolved!=="undefined"?h.isResolved():a==="success"||a==="notmodified";if(d.appendCallback)if(d.template!=b){var g=d.template(i);e.append(g);f?c._loadcallback(e,g):c._error("end")}else{c._debug("template must be defined.");c._error("end")}else f?c._loadcallback(e,i):c._error("end")},error:function(){c._debug("JSON ajax request failed.");c._error("end")}})}};if(!!d.behavior&&this["retrieve_"+d.behavior]!==b){this["retrieve_"+d.behavior].call(this,i);return}if(d.state.isDestroyed){this._debug("Instance is destroyed");return false}d.state.isDuringAjax=true;d.loading.start.call(a(d.contentSelector)[0],d)},scroll:function(){var c=this.options,a=c.state;if(!!c.behavior&&this["scroll_"+c.behavior]!==b){this["scroll_"+c.behavior].call(this);return}if(a.isDuringAjax||a.isInvalidPage||a.isDone||a.isDestroyed||a.isPaused)return;if(!this._nearbottom())return;this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(b){if(a.isPlainObject(b))this.options=a.extend(true,this.options,b)}};a.fn.infinitescroll=function(b,c){var d=typeof b;switch(d){case"string":var e=Array.prototype.slice.call(arguments,1);this.each(function(){var c=a.data(this,"infinitescroll");if(!c)return false;if(!a.isFunction(c[b])||b.charAt(0)==="_")return false;c[b].apply(c,e)});break;case"object":this.each(function(){var d=a.data(this,"infinitescroll");if(d)d.update(b);else{d=new a.infinitescroll(b,c,this);!d.failed&&a.data(this,"infinitescroll",d)}})}return this};var e=a.event,d;e.special.smartscroll={setup:function(){a(this).bind("scroll",e.special.smartscroll.handler)},teardown:function(){a(this).unbind("scroll",e.special.smartscroll.handler)},handler:function(e,b){var c=this,f=arguments;e.type="smartscroll";d&&clearTimeout(d);d=setTimeout(function(){a.event.handle.apply(c,f)},b==="execAsap"?0:100)}};a.fn.smartscroll=function(a){return a?this.bind("smartscroll",a):this.trigger("smartscroll",["execAsap"])}})(window,jQuery)